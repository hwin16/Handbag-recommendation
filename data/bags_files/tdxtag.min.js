var tdx;!function(tdx){var tag=function(){function tag(){}return tag.trackVisit=function(a){var b=a.tdxPartnerId;this.options=a;var c=a?a:null;if(c&&(c.isSync||(c.isSync=!1),b)){var d=c.funnelStage+"",e=/\w+/.exec(window.location.protocol)[0]+"://"+this.server+"/visit/?pId="+b;c.userId&&(e+="&uId="+this.escapeSpaces(c.userId)),d&&(e+="&funnelStage="+this.escapeSpaces(d)),c.category&&(e+="&cat="+this.escapeSpaces(c.category)),c.subcategory&&(e+="&subcat="+this.escapeSpaces(c.subcategory)),c.productid&&(e+="&product="+this.escapeSpaces(c.productid)),c.brand&&(e+="&brand="+this.escapeSpaces(c.brand)),c.department&&(e+="&dept="+this.escapeSpaces(c.department)),c.devMode&&(e+="&devMode=true"),e+="&r="+1e5*Math.random(),this.placeScript(e)}},tag.placeScript=function(a){var b=document.getElementById("tdxTagScript");document.getElementById("tdxTagContent");b&&b.parentElement.removeChild(b);var c=document.createElement("script");c.id="tdxTagScript",c.type="text/javascript",c.async=!0,c.src=a;var d=this.options;d.isSync?document.write('<script type="text/javascript" src="'+a+'"></script>'):this.getElement().appendChild(c)},tag.getElement=function(){var a=document.getElementById("tdxTagContent");if(a)return a;a=document.createElement("div"),a.id="tdxTagContent";var b=document.getElementsByTagName("body")[0];return b.appendChild(a),a},tag.getInternetExplorerVersion=function(){var a=-1;if("Microsoft Internet Explorer"==navigator.appName){var b=navigator.userAgent,c=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=c.exec(b)&&(a=parseFloat(RegExp.$1))}return a},tag.__renderTag=function(response){if(response&&response.data){this.responseEncoded=response.data;var info=this.options;if(info.isSync)return this.__writeResult(response);var el=this.getElement();el.innerHTML=this.base64.base64_decode(response.data);for(var scripts=this.getElement().getElementsByTagName("script"),i=0;i<scripts.length;i++)if(""!=scripts[i].src){var tag=document.createElement("script");tag.src=scripts[i].src,document.getElementsByTagName("head")[0].appendChild(tag)}else eval(scripts[i].innerHTML)}else this.responseEncoded=null},tag.__writeResult=function(a){document.write(this.base64.base64_decode(a.data))},tag.__log=function(a){a&&a.data},tag.placeTdxPixel=function(a){var b=document.getElementById("tdxTrackingPixel"),c=b?b:document.createElement("img");if(c.height=1,c.width=1,c.id="tdxTrackingPixel",c.src=a,!b){var d=document.getElementsByTagName("body")[0];d.appendChild(c)}},tag.escapeSpaces=function(a){return encodeURIComponent(a)},tag.escapeCommas=function(a){return a&&"function"==typeof a.replace?a.replace(",","."):a},tag.convertCart=function(a){if(!a)return[];for(var b=[],c=0;c<a.length;c++){var d="";a[c].productId&&(d=this.escapeCommas(a[c].productId)+","+(isNaN(a[c].amount)?"":a[c].amount)+","+(isNaN(a[c].quantity)?"":a[c].quantity)+","+(isNaN(a[c].discount)?"":a[c].discount),b.push(d))}return b},tag.trackPurchase=function(a){var b=a.tdxPartnerId;this.options=a;var c=a,d=/\w+/.exec(window.location.protocol)[0]+"://"+this.server+"/purchase/?pId="+b+(c.userId?"&uId="+c.userId:"")+(c.transactionId?"&tId="+c.transactionId:"")+(isNaN(c.subTotal)?"":"&subtotal="+c.subTotal);if(c.discount&&(d+="&discount="+c.discount),c.devMode&&(d+="&devMode=true"),a.productList){var e=JSON.stringify(this.convertCart(a.productList));e=this.base64.base64url_encode(e),d+="&products="+e}c.devMode?this.placeScript(d):this.placeTdxPixel(d)},tag.server="ts.tdxio.com",tag.base64={b64c:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64u:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",b64pad:"=",base64_encode_data:function(a,b,c){for(var d="",e=0;e<=b-3;e+=3)d+=c.charAt(a.charCodeAt(e)>>>2),d+=c.charAt((3&a.charCodeAt(e))<<4|a.charCodeAt(e+1)>>>4),d+=c.charAt((15&a.charCodeAt(e+1))<<2|a.charCodeAt(e+2)>>>6),d+=c.charAt(63&a.charCodeAt(e+2));return b%3==2?(d+=c.charAt(a.charCodeAt(e)>>>2),d+=c.charAt((3&a.charCodeAt(e))<<4|a.charCodeAt(e+1)>>>4),d+=c.charAt((15&a.charCodeAt(e+1))<<2),d+=this.b64pad):b%3==1&&(d+=c.charAt(a.charCodeAt(e)>>>2),d+=c.charAt((3&a.charCodeAt(e))<<4),d+=this.b64pad,d+=this.b64pad),d},base64_encode:function(a){var b=unescape(encodeURIComponent(a));return this.base64_encode_data(b,b.length,this.b64c)},base64url_encode:function(a){var b=unescape(encodeURIComponent(a));return this.base64_encode_data(b,b.length,this.b64u)},base64_charIndex:function(a){return"+"==a?62:"/"==a?63:this.b64u.indexOf(a)},base64_decode:function(a){for(var b,c,d,e,f="",g=0;g<a.length-3;g+=4)b=this.base64_charIndex(a.charAt(g+0)),c=this.base64_charIndex(a.charAt(g+1)),d=this.base64_charIndex(a.charAt(g+2)),e=this.base64_charIndex(a.charAt(g+3)),f+=String.fromCharCode(b<<2|c>>>4),a.charAt(g+2)!=this.b64pad&&(f+=String.fromCharCode(c<<4&240|d>>>2&15)),a.charAt(g+3)!=this.b64pad&&(f+=String.fromCharCode(d<<6&192|e));return decodeURIComponent(escape(f))},base64url_sniff:function(a){return a.indexOf("-")>=0||a.indexOf("_")>=0}},tag}();tdx.tag=tag}(tdx||(tdx={}));var tdxTag=tdx.tag;